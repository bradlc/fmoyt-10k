{"version":3,"sources":["main.js","_inert.js","_idb_keyval.js"],"names":["formatDate","date","months","year","substring","month","parseInt","day","once","fn","_rootElement","result","apply","context","this","arguments","debounce","func","wait","immediate","timeout","args","later","callNow","setTimeout","get","url","success","xhr","window","_inertManager","XMLHttpRequest","ActiveXObject","open","onreadystatechange","readyState","status","responseText","setRequestHeader","send","flip","e","preventDefault","poster","querySelector","modalActive","image","activeElement","src","contains","currentSrc","style","backgroundImage","node","startNode","add","body","classList","fromRect","parentNode","toRect","getBoundingClientRect","scale","width","left","top","transform","remove","opacity","addEventListener","inert","textContent","innerHTML","disabled","focusedItem","record","borderRadius","nodeType","ELEMENT_NODE","matches","href","target","closest","data","movieData","JSON","parse","title","overview","release_date","genreStr","inertNode","_managedNodes","genres","map","id","join","cast","length","director","directors","runtime","imdbId","_unmanageNode","display","youtube_id","inertSubroot","then","saved","setInert","i","setAttribute","_manageNode","savedInertNode","requestAnimationFrame","createGridItem","releaseDate","li","document","createElement","a","div","img","alt","h3","time","_adoptInertRoot","appendChild","getPerRow","items","newTop","getNodeIndex","_inertRoots","previousElementSibling","composedTreeWalk","callback","shadowRootAncestor","Node","element","shadowRoot","webkitShadowRoot","localName","content","distributedNodes","getDistributedNodes","slot","assignedNodes","flatten","child","firstChild","nextSibling","addInertStyle","_focusableElementsString","InertRoot","rootElement","inertManager","Set","_makeSubtreeUnfocusable","_observer","MutationObserver","_onMutation","bind","observe","attributes","childList","subtree","disconnect","removeAttribute","_step","Symbol","iterator","_iteratorNormalCompletion","_iterator","next","done","value","_visitNode","root","undefined","DOCUMENT_FRAGMENT_NODE","blur","hasAttribute","register","deregister","delete","getInertRoot","_step2","managedNodes","_iteratorNormalCompletion2","_iterator2","records","self","_step3","_iteratorNormalCompletion3","_iterator3","type","_step4","Array","from","addedNodes","_iteratorNormalCompletion4","_iterator4","_step5","removedNodes","_iteratorNormalCompletion5","_iterator5","_unmanageSubtree","attributeName","_step6","_iteratorNormalCompletion6","_iterator6","managedNode","InertNode","inertRoot","_node","_overrodeFocusMethod","_destroyed","ensureUntabbable","_throwIfDestroyed","hasSavedTabIndex","savedTabIndex","focus","destroyed","Error","tabIndex","_savedTabIndex","size","destructor","InertManager","_document","Map","_watchForInert","head","documentElement","_onDocumentLoaded","has","set","parent","addInertRoot","removeInertRoot","inertElements","querySelectorAll","_step7","_iteratorNormalCompletion7","_iterator7","inertElement","_step8","_iteratorNormalCompletion8","_iterator8","_step9","_iteratorNormalCompletion9","_iterator9","unshift","_step10","_iteratorNormalCompletion10","_iterator10","defineProperty","Element","prototype","getDB","db","Promise","resolve","reject","openreq","indexedDB","onerror","error","onupgradeneeded","createObjectStore","onsuccess","withStore","transaction","oncomplete","objectStore","idbKeyval","key","req","store","put","clear","keys","openKeyCursor","openCursor","call","push","continue","module","exports","ElementPrototype","matchesSelector","webkitMatchesSelector","msMatchesSelector","selector","nodes","el","videoActive","activeItem","activeMovie","main","header","footer","movieContainer","movieContainerBg","movie","movieInner","movieFront","movieBack","movieBackPoster","movieOverview","movieReleaseDate","movieGenre","movieStarring","movieDirector","movieRuntime","movieIMDB","movieLink","grid","saveBtn","saveBtnText","saveBtnIcon","savedCount","watch","iframe","UP","RIGHT","DOWN","LEFT","ESC","item","loadMore","link","currentPage","match","movies","els","createDocumentFragment","init","perRow","which","activeEl","currentIndex","newIndex","save","slice","_","console","log","tablist","tabs","panels","getAttribute","ul"],"mappings":"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","file":"main.js","sourcesContent":["/* global imgix */\n\n// matches polyfill\nwindow.Element && function(ElementPrototype) {\n    ElementPrototype.matches = ElementPrototype.matches ||\n    ElementPrototype.matchesSelector ||\n    ElementPrototype.webkitMatchesSelector ||\n    ElementPrototype.msMatchesSelector ||\n    function(selector) {\n        var node = this, nodes = (node.parentNode || node.document).querySelectorAll(selector), i = -1;\n        while (nodes[++i] && nodes[i] != node);\n        return !!nodes[i];\n    }\n}(Element.prototype);\n\n// closest polyfill\nwindow.Element && function(ElementPrototype) {\n    ElementPrototype.closest = ElementPrototype.closest ||\n    function(selector) {\n        var el = this;\n        while (el.matches && !el.matches(selector)) el = el.parentNode;\n        return el.matches ? el : null;\n    }\n}(Element.prototype);\n\nconst genres = {\n  x28: 'Action',\n  x12: 'Adventure',\n  x16: 'Animation',\n  x35: 'Comedy',\n  x80: 'Crime',\n  x99: 'Documentary',\n  x18: 'Drama',\n  x10751: 'Family',\n  x14: 'Fantasy',\n  x36: 'History',\n  x27: 'Horror',\n  x10402: 'Music',\n  x9648: 'Mystery',\n  x10749: 'Romance',\n  x878: 'Science Fiction',\n  x10770: 'TV Movie',\n  x53: 'Thriller',\n  x10752: 'War',\n  x37: 'Western',\n};\n\nimport './_inert.js';\nimport './_idb_keyval.js';\n\nlet modalActive = false;\nlet videoActive = false;\nlet activeItem = null;\nlet activeMovie = null;\n\nconst main = document.querySelector('.js-main');\nconst header = document.querySelector('.js-header');\nconst footer = document.querySelector('.js-footer');\nconst movieContainer = document.querySelector('.js-movie-container');\nconst movieContainerBg = document.querySelector('.js-movie-container-bg');\nconst movie = document.querySelector('.js-movie');\nconst movieInner = document.querySelector('.js-movie-inner');\nconst movieFront = document.querySelector('.js-movie-front');\nconst movieBack = document.querySelector('.js-movie-back');\nconst movieBackPoster = document.querySelector('.js-movie-back-poster');\n\nconst movieTitle = document.querySelector('.js-movie-title');\nconst movieOverview = document.querySelector('.js-movie-overview');\nconst movieReleaseDate = document.querySelector('.js-movie-release-date');\nconst movieGenre = document.querySelector('.js-movie-genre');\nconst movieStarring = document.querySelector('.js-movie-starring');\nconst movieDirector = document.querySelector('.js-movie-director');\nconst movieRuntime = document.querySelector('.js-movie-runtime');\nconst movieIMDB = document.querySelector('.js-imdb');\nconst movieLink = document.querySelector('.js-movie-link');\n\nconst grid = document.querySelector('.js-grid');\nlet items = document.querySelectorAll('.js-grid-item');\n\nconst saveBtn = document.querySelector('.js-save');\nconst saveBtnText = document.querySelector('.js-save .btn__text');\nconst saveBtnIcon = document.querySelector('.js-save .btn__icon');\nlet savedCount = 0;\n\nconst watch = document.querySelector('.js-watch');\nconst iframe = document.querySelector('.js-iframe');\n\nlet focusedItem = null;\n\nconst UP = 38;\nconst RIGHT = 39;\nconst DOWN = 40;\nconst LEFT = 37;\nconst ESC = 27;\n\nif (!movieContainer.classList.contains('movie-container--single')) {\n  movieContainer.inert = true;\n}\n\nwatch.inert = true;\n\nfunction formatDate(date) {\n  const months = ['January', 'February', 'March', 'April', 'May', 'June', 'July', 'August', 'September', 'October', 'November', 'December'];\n  const year = date.substring(0, 4);\n  let month = date.substring(5, 7);\n  month = (month.substring(0, 1) === '0') ? month.substring(1) : month;\n  month = months[parseInt(month, 10) - 1];\n  let day = date.substring(8, 10);\n  day = (day.substring(0, 1) === '0') ? day.substring(1) : day;\n  return `${day} ${month} ${year}`;\n}\n\n/* eslint-disable */\nfunction once(fn, context) {\n  let result;\n\n  return function () {\n    if (fn) {\n      result = fn.apply(context || this, arguments);\n      fn = null;\n    }\n\n    return result;\n  };\n}\n\nfunction debounce(func, wait, immediate) {\n  let timeout;\n  return function() {\n    const context = this;\n    const args = arguments;\n    const later = function later() {\n      timeout = null;\n      if (!immediate) func.apply(context, args);\n    };\n    const callNow = immediate && !timeout;\n    clearTimeout(timeout);\n    timeout = setTimeout(later, wait);\n    if (callNow) func.apply(context, args);\n  };\n}\n\nfunction get(url, success) {\n  var xhr = window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject('Microsoft.XMLHTTP');\n  xhr.open('GET', url);\n\n  xhr.onreadystatechange = () => {\n    if (xhr.readyState > 3 && xhr.status === 200) success(xhr.responseText);\n  };\n\n  xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest');\n  xhr.send();\n\n  return xhr;\n}\n/* eslint-enable */\n\nfunction flip(e) {\n  if (typeof e !== 'undefined') e.preventDefault();\n\n  const poster = this.querySelector('.js-grid-poster');\n\n  // update poster\n  if (!modalActive) {\n    const image = poster.querySelector('img');\n    const src = typeof image.currentSrc !== 'undefined' ? image.currentSrc : image.src;\n    movieFront.style.backgroundImage = `url('${src}')`;\n    movieBackPoster.style.backgroundImage = `url('${src}')`;\n\n    movieContainer.classList.add('movie-container--visible');\n\n    document.body.classList.add('no-scroll');\n  }\n\n  const fromRect = movie.getBoundingClientRect();\n  const toRect = poster.getBoundingClientRect();\n\n  const scale = 1 / (fromRect.width / toRect.width);\n  const left = toRect.left - fromRect.left;\n  const top = toRect.top - fromRect.top;\n\n  movie.style.transform = `translate(${left}px, ${top}px)`;\n  movieInner.style.transform = `scale(${scale})`;\n\n  // border radius\n  if (!modalActive) {\n    const borderRadius = 3 * (1 / scale);\n    movieFront.style.borderRadius = `${borderRadius}px`;\n    movieBack.style.borderRadius = `${borderRadius}px`;\n\n    poster.style.opacity = 0;\n\n    movieContainer.inert = false;\n    main.inert = true;\n    header.inert = true;\n    footer.inert = true;\n\n    const href = e.target.closest('a').href;\n\n    get(href, data => {\n      const movieData = JSON.parse(data);\n      movieTitle.textContent = movieData.title;\n      movieOverview.textContent = movieData.overview;\n      movieReleaseDate.textContent = formatDate(movieData.release_date);\n\n      let genreStr = '–';\n      if (movieData.genres.length) {\n        genreStr = movieData.genres.map(id => {\n          return genres[`x${id}`];\n        }).join(', ');\n      }\n      movieGenre.textContent = genreStr;\n\n      let cast = '–';\n      if (movieData.cast && movieData.cast.length) {\n        cast = movieData.cast.join(', ');\n      }\n      movieStarring.textContent = cast;\n\n      let director = '–';\n      if (movieData.directors && movieData.directors.length) {\n        director = movieData.directors.join(', ');\n      }\n      movieDirector.textContent = director;\n\n      let runtime = '–';\n      if (movieData.runtime) {\n        runtime = `${movieData.runtime} mins`;\n      }\n      movieRuntime.textContent = runtime;\n\n      if (movieData.imdbId) {\n        movieIMDB.href = `http://www.imdb.com/title/${movieData.imdbId}/`;\n        movieIMDB.style.display = 'inline';\n      } else {\n        movieIMDB.style.display = 'none';\n      }\n\n      movieLink.href = `https://www.youtube.com/watch?v=${movieData.youtube_id}`;\n\n      activeMovie = {\n        title: movieData.title,\n        overview: movieData.overview,\n        poster: movieData.poster,\n        release_date: movieData.release_date,\n        id: movieData.youtube_id,\n      };\n\n      idbKeyval.get('fmoyt-saved').then(saved => {\n        if (!saved || typeof saved === 'undefined') return;\n\n        for (let i = 0; i < saved.length; i++) {\n          if (saved[i].id === movieData.youtube_id) {\n            saveBtnText.textContent = 'Saved';\n            saveBtnIcon.innerHTML = `<svg viewBox=\"0 0 24 24\"><path d=\"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z\"/></svg>`;\n            saveBtn.disabled = true;\n            break;\n          }\n        }\n      });\n\n      saveBtn.setAttribute('data-title', movieData.title);\n      saveBtn.setAttribute('data-id', movieData.youtube_id);\n    });\n\n    window.requestAnimationFrame(() => {\n      movieContainer.classList.add('movie-container--animate');\n      movieInner.style.transform = 'none';\n      movie.style.transform = 'none';\n      movieContainerBg.style.opacity = 1;\n      movie.classList.add('movie--flipped');\n    });\n  } else {\n    movie.classList.remove('movie--flipped');\n    movieContainerBg.style.opacity = 0;\n    movie.addEventListener('transitionend', once(() => {\n      poster.style.opacity = 1;\n      movieContainer.classList.remove('movie-container--animate');\n      movieContainer.classList.remove('movie-container--visible');\n      document.body.classList.remove('no-scroll');\n      movie.style.transform = 'none';\n      movieInner.style.transform = 'none';\n\n      movieContainer.inert = true;\n      main.inert = false;\n      header.inert = false;\n      footer.inert = false;\n\n      // reset save button\n      saveBtnText.textContent = 'Save';\n      saveBtnIcon.innerHTML = `<svg viewBox=\"0 0 24 24\"><path d=\"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2zm0 15l-5-2.18L7 18V5h10v13z\"/></svg>`;\n      saveBtn.disabled = false;\n\n      if (focusedItem) {\n        focusedItem.focus();\n      }\n    }));\n  }\n\n  modalActive = !modalActive;\n  activeItem = this;\n}\n\nif (grid) {\n  window.addEventListener('click', e => {\n    const item = e.target.closest('.js-grid-item');\n    if (item) {\n      e.preventDefault();\n      flip.bind(item, e)();\n    }\n  });\n\n  grid.addEventListener('focus', e => {\n    focusedItem = e.target.closest('.js-grid-item');\n  }, true);\n}\n\nmovieContainerBg.addEventListener('click', () => {\n  flip.bind(activeItem)();\n});\n\ndocument.querySelector('.js-close-movie').addEventListener('click', () => {\n  flip.bind(activeItem)();\n});\n\n/**\n * Load more\n */\nconst loadMore = document.querySelector('.js-load-more');\n\nfunction createGridItem(id, poster, title, releaseDate) {\n  const li = document.createElement('li');\n  li.classList.add('grid-item');\n\n  const a = document.createElement('a');\n  a.href = `/${id}`;\n  a.classList.add('js-grid-item');\n\n  const div = document.createElement('div');\n  div.classList.add('grid-item__poster');\n  div.classList.add('js-grid-poster');\n\n  const img = document.createElement('img');\n  img.setAttribute('ix-src', `https://fmoyt-10k.imgix.net${poster}?w=320&amp;h=480&amp;fit=crop&amp;auto=format,compress`);\n  img.alt = '';\n  img.setAttribute('sizes', '170px');\n  img.classList.add('lazyload');\n\n  const h3 = document.createElement('h3');\n  h3.textContent = title;\n\n  const year = releaseDate.substring(0, 4);\n  const time = document.createElement('time');\n  time.setAttribute('datetime', year);\n  time.classList.add('mono');\n  time.textContent = year;\n\n  div.appendChild(img);\n  a.appendChild(div);\n  a.appendChild(h3);\n  a.appendChild(time);\n  li.appendChild(a);\n\n  return li;\n}\n\nif (loadMore) {\n  loadMore.addEventListener('click', e => {\n    e.preventDefault();\n\n    const link = e.target.closest('a');\n    const href = link.href;\n\n    let currentPage = href.match(/[0-9]+$/);\n    currentPage = parseInt(currentPage[0], 10);\n    link.href = `/page/${currentPage + 1}`;\n\n    link.setAttribute('disabled', 'disabled');\n\n    if (currentPage === 20) {\n      link.style.display = 'none';\n    }\n\n    get(href, data => {\n      const movies = JSON.parse(data);\n      const els = document.createDocumentFragment();\n      for (let i = 0; i < movies.length; i++) {\n        const li = createGridItem(movies[i].youtube_id, movies[i].poster, movies[i].title, movies[i].release_date);\n        els.appendChild(li);\n      }\n\n      grid.appendChild(els);\n      link.removeAttribute('disabled');\n\n      requestAnimationFrame(() => {\n        items = document.querySelectorAll('.js-grid-item');\n        imgix.init({\n          srcAttribute: 'data-src',\n          srcsetAttribute: 'data-srcset',\n          sizesAttribute: 'data-sizes',\n        });\n      });\n    });\n  });\n}\n\n/**\n * Keyboard nav\n */\nfunction getPerRow() {\n  let top = null;\n  let i;\n  for (i = 0; i < items.length; i++) {\n    const newTop = items[i].getBoundingClientRect().top;\n    if (top !== null && newTop !== top) {\n      break;\n    }\n    top = newTop;\n  }\n  return i;\n}\nlet perRow = getPerRow();\nwindow.addEventListener('resize', debounce(() => {\n  perRow = getPerRow();\n}, 250));\n\ndocument.addEventListener('keydown', e => {\n  if (e.which !== UP && e.which !== RIGHT && e.which !== DOWN && e.which !== LEFT) return;\n  const activeEl = document.activeElement;\n  if (!activeEl.closest('.grid-item')) {\n    items[0].focus();\n    return;\n  }\n  const currentIndex = getNodeIndex(activeEl.closest('.grid-item'));\n  let newIndex;\n  if (e.which === LEFT) {\n    newIndex = currentIndex - 1;\n  }\n  if (e.which === RIGHT) {\n    newIndex = currentIndex + 1;\n  }\n  if (e.which === DOWN) {\n    newIndex = currentIndex + perRow;\n  }\n  if (e.which === UP) {\n    newIndex = currentIndex - perRow;\n  }\n  if (newIndex >= 0 && newIndex < items.length) {\n    items[newIndex].focus();\n  }\n});\n\ndocument.addEventListener('keydown', e => {\n  if (e.which === ESC && videoActive) {\n    videoActive = false;\n    watch.classList.remove('watch--active');\n    watch.addEventListener('transitionend', once(() => {\n      iframe.src = '';\n      watch.inert = true;\n      movieContainer.inert = false;\n    }));\n    return;\n  }\n  if (e.which === ESC && modalActive) {\n    flip.bind(activeItem)();\n  }\n});\n\nfunction getNodeIndex(node) {\n  for (var i = 0; node = node.previousElementSibling; i++);\n  return i;\n}\n\n\n/**\n * Save\n */\nsaveBtn.style.display = 'inline-block';\nsaveBtn.addEventListener('click', e => {\n  const btn = e.target.closest('.js-save');\n  idbKeyval.get('fmoyt-saved').then(saved => {\n    let save;\n    if (typeof saved === 'undefined') {\n      save = [];\n    } else {\n      save = saved.slice(0);\n    }\n    save.push(activeMovie);\n    idbKeyval.set('fmoyt-saved', save).then(_ => console.log('saved'));\n\n    saveBtnText.textContent = 'Saved';\n    saveBtnIcon.innerHTML = `<svg viewBox=\"0 0 24 24\"><path d=\"M17 3H7c-1.1 0-1.99.9-1.99 2L5 21l7-3 7 3V5c0-1.1-.9-2-2-2z\"/></svg>`;\n    saveBtn.disabled = true;\n\n    // add to saved grid\n    const li = createGridItem(activeMovie.id, activeMovie.poster, activeMovie.title, activeMovie.release_date);\n    document.querySelector('.js-saved-grid').appendChild(li);\n\n    savedCount++;\n    document.querySelector('.js-saved-tab').textContent = `Saved (${savedCount})`;\n\n    requestAnimationFrame(() => {\n      items = document.querySelectorAll('.js-grid-item');\n      imgix.init({\n        srcAttribute: 'data-src',\n        srcsetAttribute: 'data-srcset',\n        sizesAttribute: 'data-sizes',\n      });\n    });\n  });\n});\n\n\n\nconst tablist = document.querySelector('.js-tablist');\n\nidbKeyval.get('fmoyt-saved').then(saved => {\n  if (saved && typeof saved !== 'undefined') {\n    savedCount = saved.length;\n  }\n\n  tablist.innerHTML = `<ul role=\"tablist\">\n      <li role=\"presentation\">\n        <a class=\"js-tab\" href=\"#all\" role=\"tab\" aria-controls=\"all\" aria-selected=\"true\">All</a>\n      </li>\n      <li role=\"presentation\">\n        <a class=\"js-tab js-saved-tab\" href=\"#saved\" role=\"tab\" aria-controls=\"saved\">Saved (${savedCount})</a>\n      </li>\n    </ul>`;\n});\n\nwindow.addEventListener('click', e => {\n  if (e.target.closest('.js-tab')) {\n    e.preventDefault();\n    const tabs = document.querySelectorAll('.js-tab');\n    const panels = document.querySelectorAll('[role=\"tabpanel\"]');\n    for (let i = 0; i < tabs.length; i++) {\n      tabs[i].removeAttribute('aria-selected');\n    }\n    e.target.closest('.js-tab').setAttribute('aria-selected', 'true');\n\n    for (let i = 0; i < panels.length; i++) {\n      panels[i].setAttribute('aria-hidden', 'true');\n    }\n    document.querySelector(e.target.closest('.js-tab').getAttribute('href')).removeAttribute('aria-hidden');\n  }\n});\n\n\nidbKeyval.get('fmoyt-saved').then(saved => {\n  if (saved) {\n    const ul = document.createDocumentFragment();\n    for (let i = 0; i < saved.length; i++) {\n      const li = createGridItem(saved[i].id, saved[i].poster, saved[i].title, saved[i].release_date);\n      ul.appendChild(li);\n    }\n    document.querySelector('.js-saved-grid').appendChild(ul);\n    requestAnimationFrame(() => {\n      items = document.querySelectorAll('.js-grid-item');\n      imgix.init({\n        srcAttribute: 'data-src',\n        srcsetAttribute: 'data-srcset',\n        sizesAttribute: 'data-sizes',\n      });\n    });\n  }\n});\n\n\nmovieLink.addEventListener('click', e => {\n  e.preventDefault();\n\n  watch.inert = false;\n  movieContainer.inert = true;\n  videoActive = true;\n  watch.classList.add('watch--active');\n  watch.addEventListener('transitionend', once(() => {\n    iframe.src = `https://www.youtube.com/embed/${activeMovie.id}?autoplay=1`;\n  }));\n});\n\n\ndocument.querySelector('.js-close-watch').addEventListener('click', () => {\n  videoActive = false;\n  watch.classList.remove('watch--active');\n  watch.addEventListener('transitionend', once(() => {\n    iframe.src = '';\n    watch.inert = true;\n    movieContainer.inert = false;\n  }));\n});\n","/**\n *\n * Copyright 2016 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n(function(document) {\n\n/** @type {string} */\nconst _focusableElementsString = ['a[href]',\n                                  'area[href]',\n                                  'input:not([disabled])',\n                                  'select:not([disabled])',\n                                  'textarea:not([disabled])',\n                                  'button:not([disabled])',\n                                  'iframe',\n                                  'object',\n                                  'embed',\n                                  '[contenteditable]'].join(',');\n\n/**\n * `InertRoot` manages a single inert subtree, i.e. a DOM subtree whose root element has an `inert`\n * attribute.\n *\n * Its main functions are:\n *\n * - to create and maintain a set of managed `InertNode`s, including when mutations occur in the\n *   subtree. The `makeSubtreeUnfocusable()` method handles collecting `InertNode`s via registering\n *   each focusable node in the subtree with the singleton `InertManager` which manages all known\n *   focusable nodes within inert subtrees. `InertManager` ensures that a single `InertNode`\n *   instance exists for each focusable node which has at least one inert root as an ancestor.\n *\n * - to notify all managed `InertNode`s when this subtree stops being inert (i.e. when the `inert`\n *   attribute is removed from the root node). This is handled in the destructor, which calls the\n *   `deregister` method on `InertManager` for each managed inert node.\n */\nclass InertRoot {\n  /**\n   * @param {Element} rootElement The Element at the root of the inert subtree.\n   * @param {InertManager} inertManager The global singleton InertManager object.\n   */\n  constructor(rootElement, inertManager) {\n    /** @type {InertManager} */\n    this._inertManager = inertManager;\n\n    /** @type {Element} */\n    this._rootElement = rootElement;\n\n    /**\n     * @type {Set<Node>}\n     * All managed focusable nodes in this InertRoot's subtree.\n     */\n    this._managedNodes = new Set([]);\n\n    // Make the subtree hidden from assistive technology\n    this._rootElement.setAttribute('aria-hidden', 'true');\n\n    // Make all focusable elements in the subtree unfocusable and add them to _managedNodes\n    this._makeSubtreeUnfocusable(this._rootElement);\n\n    // Watch for:\n    // - any additions in the subtree: make them unfocusable too\n    // - any removals from the subtree: remove them from this inert root's managed nodes\n    // - attribute changes: if `tabindex` is added, or removed from an intrinsically focusable element,\n    //   make that node a managed node.\n    this._observer = new MutationObserver(this._onMutation.bind(this));\n    this._observer.observe(this._rootElement, { attributes: true, childList: true, subtree: true });\n  }\n\n  /**\n   * Call this whenever this object is about to become obsolete.  This unwinds all of the state\n   * stored in this object and updates the state of all of the managed nodes.\n   */\n  destructor() {\n    this._observer.disconnect();\n    this._observer = null;\n\n    if (this._rootElement)\n      this._rootElement.removeAttribute('aria-hidden');\n    this._rootElement = null;\n\n    for (let inertNode of this._managedNodes)\n      this._unmanageNode(inertNode.node);\n\n    this._managedNodes = null;\n\n    this._inertManager = null;\n  }\n\n  /**\n   * @return {Set<InertNode>} A copy of this InertRoot's managed nodes set.\n   */\n  get managedNodes() {\n    return new Set(this._managedNodes);\n  }\n\n  /**\n   * @param {Node} startNode\n   */\n  _makeSubtreeUnfocusable(startNode) {\n    composedTreeWalk(startNode, (node) => { this._visitNode(node); });\n\n    let activeElement = document.activeElement;\n    if (!document.contains(startNode)) {\n      // startNode may be in shadow DOM, so find its nearest shadowRoot to get the activeElement.\n      let node = startNode;\n      let root = undefined;\n      while (node) {\n        if (node.nodeType === Node.DOCUMENT_FRAGMENT_NODE) {\n          root = node;\n          break;\n        }\n        node = node.parentNode;\n      }\n      if (root)\n        activeElement = root.activeElement\n    }\n    if (startNode.contains(activeElement))\n      activeElement.blur();\n  }\n\n  /**\n   * @param {Node} node\n   */\n  _visitNode(node) {\n    if (node.nodeType !== Node.ELEMENT_NODE)\n      return;\n\n    // If a descendant inert root becomes un-inert, its descendants will still be inert because of this\n    // inert root, so all of its managed nodes need to be adopted by this InertRoot.\n    if (node !== this._rootElement && node.hasAttribute('inert'))\n      this._adoptInertRoot(node);\n\n    if (node.matches(_focusableElementsString) || node.hasAttribute('tabindex'))\n      this._manageNode(node);\n  }\n\n  /**\n   * Register the given node with this InertRoot and with InertManager.\n   * @param {Node} node\n   */\n  _manageNode(node) {\n    const inertNode = this._inertManager.register(node, this);\n    this._managedNodes.add(inertNode);\n  }\n\n  /**\n   * Unregister the given node with this InertRoot and with InertManager.\n   * @param {Node} node\n   */\n  _unmanageNode(node) {\n    const inertNode = this._inertManager.deregister(node, this);\n    if (inertNode)\n      this._managedNodes.delete(inertNode);\n  }\n\n  /**\n   * Unregister the entire subtree starting at `startNode`.\n   * @param {Node} startNode\n   */\n  _unmanageSubtree(startNode) {\n    composedTreeWalk(startNode, (node) => { this._unmanageNode(node); });\n  }\n\n  /**\n   * If a descendant node is found with an `inert` attribute, adopt its managed nodes.\n   * @param {Node} node\n   */\n  _adoptInertRoot(node) {\n    let inertSubroot = this._inertManager.getInertRoot(node);\n\n    // During initialisation this inert root may not have been registered yet,\n    // so register it now if need be.\n    if (!inertSubroot) {\n      this._inertManager.setInert(node, true);\n      inertSubroot = this._inertManager.getInertRoot(node);\n    }\n\n    for (let savedInertNode of inertSubroot.managedNodes)\n      this._manageNode(savedInertNode.node);\n  }\n\n  /**\n   * Callback used when mutation observer detects subtree additions, removals, or attribute changes.\n   * @param {MutationRecord} records\n   * @param {MutationObserver} self\n   */\n  _onMutation(records, self) {\n    for (let record of records) {\n      const target = record.target;\n      if (record.type === 'childList') {\n        // Manage added nodes\n        for (let node of Array.from(record.addedNodes))\n          this._makeSubtreeUnfocusable(node);\n\n        // Un-manage removed nodes\n        for (let node of Array.from(record.removedNodes))\n          this._unmanageSubtree(node);\n      } else if (record.type === 'attributes') {\n        if (record.attributeName === 'tabindex') {\n          // Re-initialise inert node if tabindex changes\n          this._manageNode(target);\n        } else if (target !== this._rootElement &&\n                   record.attributeName === 'inert' &&\n                   target.hasAttribute('inert')) {\n          // If a new inert root is added, adopt its managed nodes and make sure it knows about the\n          // already managed nodes from this inert subroot.\n          this._adoptInertRoot(target);\n          const inertSubroot = this._inertManager.getInertRoot(target);\n          for (let managedNode of this._managedNodes) {\n            if (target.contains(managedNode.node))\n              inertSubroot._manageNode(managedNode.node);\n          }\n        }\n      }\n    }\n  }\n}\n\n/**\n * `InertNode` initialises and manages a single inert node.\n * A node is inert if it is a descendant of one or more inert root elements.\n *\n * On construction, `InertNode` saves the existing `tabindex` value for the node, if any, and\n * either removes the `tabindex` attribute or sets it to `-1`, depending on whether the element\n * is intrinsically focusable or not.\n *\n * `InertNode` maintains a set of `InertRoot`s which are descendants of this `InertNode`. When an\n * `InertRoot` is destroyed, and calls `InertManager.deregister()`, the `InertManager` notifies the\n * `InertNode` via `removeInertRoot()`, which in turn destroys the `InertNode` if no `InertRoot`s\n * remain in the set. On destruction, `InertNode` reinstates the stored `tabindex` if one exists,\n * or removes the `tabindex` attribute if the element is intrinsically focusable.\n */\nclass InertNode {\n  /**\n   * @param {Node} node A focusable element to be made inert.\n   * @param {InertRoot} inertRoot The inert root element associated with this inert node.\n   */\n  constructor(node, inertRoot) {\n    /** @type {Node} */\n    this._node = node;\n\n    /** @type {boolean} */\n    this._overrodeFocusMethod = false;\n\n    /**\n     * @type {Set<InertRoot>} The set of descendant inert roots.\n     *    If and only if this set becomes empty, this node is no longer inert.\n     */\n    this._inertRoots = new Set([inertRoot]);\n\n    /** @type {boolean} */\n    this._destroyed = false;\n\n    // Save any prior tabindex info and make this node untabbable\n    this.ensureUntabbable();\n  }\n\n  /**\n   * Call this whenever this object is about to become obsolete.\n   * This makes the managed node focusable again and deletes all of the previously stored state.\n   */\n  destructor() {\n    this._throwIfDestroyed();\n\n    if (this._node) {\n      if (this.hasSavedTabIndex)\n        this._node.setAttribute('tabindex', this.savedTabIndex);\n      else\n        this._node.removeAttribute('tabindex');\n\n      // Use `delete` to restore native focus method.\n      if (this._overrodeFocusMethod)\n        delete this._node.focus;\n    }\n    this._node = null;\n    this._inertRoots = null;\n\n    this._destroyed = true;\n  }\n\n  /**\n   * @type {boolean} Whether this object is obsolete because the managed node is no longer inert.\n   * If the object has been destroyed, any attempt to access it will cause an exception.\n   */\n  get destroyed() {\n    return this._destroyed;\n  }\n\n  _throwIfDestroyed() {\n    if (this.destroyed)\n      throw new Error(\"Trying to access destroyed InertNode\");\n  }\n\n  /** @return {boolean} */\n  get hasSavedTabIndex() {\n    return '_savedTabIndex' in this;\n  }\n\n  /** @return {Node} */\n  get node() {\n    this._throwIfDestroyed();\n    return this._node;\n  }\n\n  /** @param {number} tabIndex */\n  set savedTabIndex(tabIndex) {\n    this._throwIfDestroyed();\n    this._savedTabIndex = tabIndex;\n  }\n\n  /** @return {number} */\n  get savedTabIndex() {\n    this._throwIfDestroyed();\n    return this._savedTabIndex;\n  }\n\n  /** Save the existing tabindex value and make the node untabbable and unfocusable */\n  ensureUntabbable() {\n    const node = this.node;\n    if (node.matches(_focusableElementsString)) {\n      if (node.tabIndex === -1 && this.hasSavedTabIndex)\n        return;\n\n      if (node.hasAttribute('tabindex'))\n        this._savedTabIndex = node.tabIndex;\n      node.setAttribute('tabindex', '-1');\n      if (node.nodeType === Node.ELEMENT_NODE) {\n        node.focus = function() {};\n        this._overrodeFocusMethod = true;\n      }\n    } else if (node.hasAttribute('tabindex')) {\n      this._savedTabIndex = node.tabIndex;\n      node.removeAttribute('tabindex');\n    }\n  }\n\n  /**\n   * Add another inert root to this inert node's set of managing inert roots.\n   * @param {InertRoot} inertRoot\n   */\n  addInertRoot(inertRoot) {\n    this._throwIfDestroyed();\n    this._inertRoots.add(inertRoot);\n  }\n\n  /**\n   * Remove the given inert root from this inert node's set of managing inert roots.\n   * If the set of managing inert roots becomes empty, this node is no longer inert,\n   * so the object should be destroyed.\n   * @param {InertRoot} inertRoot\n   */\n  removeInertRoot(inertRoot) {\n    this._throwIfDestroyed();\n    this._inertRoots.delete(inertRoot);\n    if (this._inertRoots.size === 0)\n      this.destructor();\n  }\n}\n\n/**\n * InertManager is a per-document singleton object which manages all inert roots and nodes.\n *\n * When an element becomes an inert root by having an `inert` attribute set and/or its `inert`\n * property set to `true`, the `setInert` method creates an `InertRoot` object for the element.\n * The `InertRoot` in turn registers itself as managing all of the element's focusable descendant\n * nodes via the `register()` method. The `InertManager` ensures that a single `InertNode` instance\n * is created for each such node, via the `_managedNodes` map.\n */\nclass InertManager {\n  /**\n   * @param {Document} document\n   */\n  constructor(document) {\n    if (!document)\n      throw new Error('Missing required argument; InertManager needs to wrap a document.');\n\n    /** @type {Document} */\n    this._document = document;\n\n    /**\n     * All managed nodes known to this InertManager. In a map to allow looking up by Node.\n     * @type {Map<Node, InertNode>}\n     */\n    this._managedNodes = new Map();\n\n    /**\n     * All inert roots known to this InertManager. In a map to allow looking up by Node.\n     * @type {Map<Node, InertRoot>}\n     */\n    this._inertRoots = new Map();\n\n    /**\n     * Observer for mutations on `document.body`.\n     * @type {MutationObserver}\n     */\n    this._observer = new MutationObserver(this._watchForInert.bind(this));\n\n\n    // Add inert style.\n    addInertStyle(document.head || document.body || document.documentElement);\n\n    // Wait for document to be loaded.\n    if (document.readyState === 'loading') {\n      document.addEventListener('DOMContentLoaded', this._onDocumentLoaded.bind(this));\n    } else {\n      this._onDocumentLoaded();\n    }\n  }\n\n  /**\n   * Set whether the given element should be an inert root or not.\n   * @param {Element} root\n   * @param {boolean} inert\n   */\n  setInert(root, inert) {\n    if (inert) {\n      if (this._inertRoots.has(root))   // element is already inert\n        return;\n\n      const inertRoot = new InertRoot(root, this);\n      root.setAttribute('inert', '');\n      this._inertRoots.set(root, inertRoot);\n      // If not contained in the document, it must be in a shadowRoot.\n      // Ensure inert styles are added there.\n      if (!this._document.body.contains(root)) {\n        let parent = root.parentNode;\n        while (parent) {\n          if (parent.nodeType === 11) {\n            addInertStyle(parent);\n          }\n          parent = parent.parentNode;\n        }\n      }\n    } else {\n      if (!this._inertRoots.has(root))  // element is already non-inert\n        return;\n\n      const inertRoot = this._inertRoots.get(root);\n      inertRoot.destructor();\n      this._inertRoots.delete(root);\n      root.removeAttribute('inert');\n    }\n  }\n\n  /**\n   * Get the InertRoot object corresponding to the given inert root element, if any.\n   * @param {Element} element\n   * @return {InertRoot?}\n   */\n  getInertRoot(element) {\n    return this._inertRoots.get(element);\n  }\n\n  /**\n   * Register the given InertRoot as managing the given node.\n   * In the case where the node has a previously existing inert root, this inert root will\n   * be added to its set of inert roots.\n   * @param {Node} node\n   * @param {InertRoot} inertRoot\n   * @return {InertNode} inertNode\n   */\n  register(node, inertRoot) {\n    let inertNode = this._managedNodes.get(node);\n    if (inertNode !== undefined) {  // node was already in an inert subtree\n      inertNode.addInertRoot(inertRoot);\n      // Update saved tabindex value if necessary\n      inertNode.ensureUntabbable();\n    } else {\n      inertNode = new InertNode(node, inertRoot);\n    }\n\n    this._managedNodes.set(node, inertNode);\n\n    return inertNode;\n  }\n\n  /**\n   * De-register the given InertRoot as managing the given inert node.\n   * Removes the inert root from the InertNode's set of managing inert roots, and remove the inert\n   * node from the InertManager's set of managed nodes if it is destroyed.\n   * If the node is not currently managed, this is essentially a no-op.\n   * @param {Node} node\n   * @param {InertRoot} inertRoot\n   * @return {InertNode?} The potentially destroyed InertNode associated with this node, if any.\n   */\n  deregister(node, inertRoot) {\n    const inertNode = this._managedNodes.get(node);\n    if (!inertNode)\n      return null;\n\n    inertNode.removeInertRoot(inertRoot);\n    if (inertNode.destroyed)\n      this._managedNodes.delete(node);\n\n    return inertNode;\n  }\n\n  /**\n   * Callback used when document has finished loading.\n   */\n  _onDocumentLoaded() {\n    // Find all inert roots in document and make them actually inert.\n    const inertElements = Array.from(this._document.querySelectorAll('[inert]'));\n    for (let inertElement of inertElements)\n      this.setInert(inertElement, true);\n\n    // Comment this out to use programmatic API only.\n    this._observer.observe(this._document.body, { attributes: true, subtree: true, childList: true });\n  }\n\n  /**\n   * Callback used when mutation observer detects attribute changes.\n   * @param {MutationRecord} records\n   * @param {MutationObserver} self\n   */\n  _watchForInert(records, self) {\n    for (let record of records) {\n      switch (record.type) {\n      case 'childList':\n        for (let node of Array.from(record.addedNodes)) {\n          if (node.nodeType !== Node.ELEMENT_NODE)\n            continue;\n          const inertElements = Array.from(node.querySelectorAll('[inert]'));\n          if (node.matches('[inert]'))\n            inertElements.unshift(node);\n          for (let inertElement of inertElements)\n            this.setInert(inertElement, true);\n        }\n        break;\n      case 'attributes':\n        if (record.attributeName !== 'inert')\n          continue;\n        const target = record.target;\n        const inert = target.hasAttribute('inert');\n        this.setInert(target, inert);\n        break;\n      }\n    }\n  }\n}\n\n /**\n  * Recursively walk the composed tree from |node|.\n  * @param {Node} node\n  * @param {(function (Element))=} callback Callback to be called for each element traversed,\n  *     before descending into child nodes.\n  * @param {ShadowRoot=} shadowRootAncestor The nearest ShadowRoot ancestor, if any.\n  */\nfunction composedTreeWalk(node, callback, shadowRootAncestor) {\n  if (node.nodeType == Node.ELEMENT_NODE) {\n    const element = /** @type {Element} */ (node);\n    if (callback)\n      callback(element)\n\n    // Descend into node:\n    // If it has a ShadowRoot, ignore all child elements - these will be picked\n    // up by the <content> or <shadow> elements. Descend straight into the\n    // ShadowRoot.\n    const shadowRoot = element.shadowRoot || element.webkitShadowRoot;\n    if (shadowRoot) {\n      composedTreeWalk(shadowRoot, callback, shadowRoot);\n      return;\n    }\n\n    // If it is a <content> element, descend into distributed elements - these\n    // are elements from outside the shadow root which are rendered inside the\n    // shadow DOM.\n    if (element.localName == 'content') {\n      const content = /** @type {HTMLContentElement} */ (element);\n      // Verifies if ShadowDom v0 is supported.\n      const distributedNodes = content.getDistributedNodes ?\n        content.getDistributedNodes() : [];\n      for (let i = 0; i < distributedNodes.length; i++) {\n        composedTreeWalk(distributedNodes[i], callback, shadowRootAncestor);\n      }\n      return;\n    }\n\n    // If it is a <slot> element, descend into assigned nodes - these\n    // are elements from outside the shadow root which are rendered inside the\n    // shadow DOM.\n    if (element.localName == 'slot') {\n      const slot = /** @type {HTMLSlotElement} */ (element);\n      // Verify if ShadowDom v1 is supported.\n      const distributedNodes = slot.assignedNodes ?\n        slot.assignedNodes({ flatten: true }) : [];\n      for (let i = 0; i < distributedNodes.length; i++) {\n        composedTreeWalk(distributedNodes[i], callback, shadowRootAncestor);\n      }\n      return;\n    }\n  }\n\n  // If it is neither the parent of a ShadowRoot, a <content> element, a <slot>\n  // element, nor a <shadow> element recurse normally.\n  let child = node.firstChild;\n  while (child != null) {\n    composedTreeWalk(child, callback, shadowRootAncestor);\n    child = child.nextSibling;\n  }\n}\n\n/**\n * Adds a style element to the node containing the inert specific styles\n * @param {Node} node\n */\nfunction addInertStyle(node) {\n  if (node.querySelector('style#inert-style')) {\n    return;\n  }\n  const style = document.createElement('style');\n  style.setAttribute('id', 'inert-style');\n  style.textContent = \"\\n\"+\n                      \"[inert] {\\n\" +\n                      \"  pointer-events: none;\\n\" +\n                      \"  cursor: default;\\n\" +\n                      \"}\\n\" +\n                      \"\\n\" +\n                      \"[inert], [inert] * {\\n\" +\n                      \"  user-select: none;\\n\" +\n                      \"  -webkit-user-select: none;\\n\" +\n                      \"  -moz-user-select: none;\\n\" +\n                      \"  -ms-user-select: none;\\n\" +\n                      \"}\\n\";\n  node.appendChild(style);\n}\n\nconst inertManager = new InertManager(document);\n\nObject.defineProperty(Element.prototype, 'inert', {\n                        enumerable: true,\n                        get: function() { return this.hasAttribute('inert'); },\n                        set: function(inert) { inertManager.setInert(this, inert) }\n                      });\n\n})(document);\n","(function() {\n  'use strict';\n  var db;\n\n  function getDB() {\n    if (!db) {\n      db = new Promise(function(resolve, reject) {\n        var openreq = indexedDB.open('keyval-store', 1);\n        \n        openreq.onerror = function() {\n          reject(openreq.error);\n        };\n        \n        openreq.onupgradeneeded = function() {\n          // First time setup: create an empty object store\n          openreq.result.createObjectStore('keyval');\n        };\n\n        openreq.onsuccess = function() {\n          resolve(openreq.result);\n        };\n      });\n    }\n    return db;\n  }\n\n  function withStore(type, callback) {\n    return getDB().then(function(db) {\n      return new Promise(function(resolve, reject) {\n        var transaction = db.transaction('keyval', type);\n        transaction.oncomplete = function() {\n          resolve();\n        };\n        transaction.onerror = function() {\n          reject(transaction.error);\n        };\n        callback(transaction.objectStore('keyval'));\n      });\n    });\n  }\n\n  var idbKeyval = {\n    get: function(key) {\n      var req;\n      return withStore('readonly', function(store) {\n        req = store.get(key);\n      }).then(function() {\n        return req.result;\n      });\n    },\n    set: function(key, value) {\n      return withStore('readwrite', function(store) {\n        store.put(value, key);\n      });\n    },\n    delete: function(key) {\n      return withStore('readwrite', function(store) {\n        store.delete(key);\n      });\n    },\n    clear: function() {\n      return withStore('readwrite', function(store) {\n        store.clear();\n      });\n    },\n    keys: function() {\n      var keys = [];\n      return withStore('readonly', function(store) {\n        // This would be store.getAllKeys(), but it isn't supported by Edge or Safari.\n        // And openKeyCursor isn't supported by Safari.\n        (store.openKeyCursor || store.openCursor).call(store).onsuccess = function() {\n          if (!this.result) return;\n          keys.push(this.result.key);\n          this.result.continue();\n        };  \n      }).then(function() {\n        return keys;\n      });\n    }\n  };\n\n  if (typeof module != 'undefined' && module.exports) {\n    module.exports = idbKeyval;\n  } else {\n    self.idbKeyval = idbKeyval;\n  }\n}());\n"],"sourceRoot":"/source/"}